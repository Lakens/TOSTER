% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/perm_ses_test.R
\name{perm_ses_test}
\alias{perm_ses_test}
\alias{perm_ses_test.default}
\alias{perm_ses_test.formula}
\title{Permutation Test for Standardized Effect Sizes}
\usage{
perm_ses_test(
  x,
  ...,
  paired = FALSE,
  ses = c("rb", "cstat", "odds", "logodds"),
  alpha = 0.05,
  mu = NULL,
  alternative = c("two.sided", "less", "greater", "equivalence", "minimal.effect"),
  R = NULL,
  symmetric = TRUE,
  p_method = NULL,
  keep_perm = TRUE
)

\method{perm_ses_test}{default}(
  x,
  y = NULL,
  paired = FALSE,
  ses = c("rb", "cstat", "odds", "logodds"),
  alpha = 0.05,
  mu = NULL,
  alternative = c("two.sided", "less", "greater", "equivalence", "minimal.effect"),
  R = NULL,
  symmetric = TRUE,
  p_method = NULL,
  keep_perm = TRUE,
  ...
)

\method{perm_ses_test}{formula}(formula, data, subset, na.action, ...)
}
\arguments{
\item{x}{a (non-empty) numeric vector of data values.}

\item{...}{further arguments to be passed to or from methods.}

\item{paired}{a logical indicating whether you want a paired t-test. Cannot be used with the formula method; use x and y vectors instead for paired tests.}

\item{ses}{a character string specifying the effect size measure to test:
- "rb": rank-biserial correlation (default)
- "odds": Wilcoxon-Mann-Whitney odds
- "logodds": Wilcoxon-Mann-Whitney log-odds
- "cstat": concordance statistic (C-statistic, equivalent to the area under the ROC curve)}

\item{alpha}{significance level (default = 0.05).}

\item{mu}{a number or vector specifying the null hypothesis value(s) on the scale of the
effect size specified by \code{ses}:
- For standard alternatives: a single value (default = 0 for rb/logodds, 0.5 for cstat, 1 for odds)
- For equivalence/minimal.effect: two values representing the lower and upper bounds}

\item{alternative}{a character string specifying the alternative hypothesis:
- "two.sided" (default): Test whether effect differs from mu
- "less": Test whether effect is less than mu
- "greater": Test whether effect is greater than mu
- "equivalence": Test whether effect is between specified bounds (TOST)
- "minimal.effect": Test whether effect is outside specified bounds}

\item{R}{the number of permutations. Default is NULL, which computes all exact permutations
if feasible. If R is specified and is less than the maximum number of possible permutations,
randomization sampling is used instead.}

\item{symmetric}{a logical variable indicating whether to assume symmetry in the two-sided test.
If \code{TRUE} (default) then the symmetric permutation p-value is computed, otherwise the
equal-tail permutation p-value is computed. Only relevant for \code{alternative = "two.sided"}.}

\item{p_method}{the method for computing permutation p-values:
- \code{NULL} (default): Automatically selects "exact" for exact permutation tests and
"plusone" for randomization tests.
- \code{"exact"}: Uses b/R where b is the count of permutation statistics at least as extreme
as observed.
- \code{"plusone"}: Uses (b+1)/(R+1), which guarantees p > 0 and provides exact Type I error
control (Phipson & Smyth, 2010).}

\item{keep_perm}{logical. If \code{TRUE} (default), the permutation distribution of the effect size
is stored in the output. Set to \code{FALSE} for large datasets to save memory.}

\item{y}{an optional (non-empty) numeric vector of data values.}

\item{formula}{a formula of the form lhs ~ rhs where lhs is a numeric variable giving the data values and rhs either 1 for a one-sample test or a factor with two levels giving the corresponding groups. For paired tests, use the default method with x and y vectors instead of the formula method.}

\item{data}{an optional matrix or data frame (or similar: see model.frame) containing the variables in the formula formula. By default the variables are taken from environment(formula).}

\item{subset}{an optional vector specifying a subset of observations to be used.}

\item{na.action}{a function which indicates what should happen when the data contain NAs. Defaults to getOption("na.action").}
}
\value{
A list with class \code{"htest"} containing:
\itemize{
\item statistic: the observed effect size (test statistic)
\item parameter: the number of permutations used (R)
\item p.value: the permutation p-value
\item conf.int: a permutation percentile confidence interval
\item estimate: the effect size estimate
\item null.value: the specified null hypothesis value(s)
\item alternative: a character string describing the alternative hypothesis
\item method: a character string indicating the test method
\item data.name: a character string giving the name(s) of the data
\item call: the matched call
\item R: the requested number of permutations
\item R.used: the actual number of permutations used
\item perm.dist: (if keep_perm = TRUE) the permutation distribution of the effect size
}
}
\description{
\ifelse{html}{\href{https://lifecycle.r-lib.org/articles/stages.html#maturing}{\figure{lifecycle-maturing.svg}{options: alt='[Maturing]'}}}{\strong{[Maturing]}}

Performs permutation-based hypothesis tests for non-parametric effect sizes including
concordance probability (c-statistic), rank-biserial correlation, WMW odds, and WMW log-odds.
This function provides exact or randomization-based inference without relying on asymptotic
approximations.
}
\details{
This function performs permutation-based hypothesis tests for rank-based and probability-based
effect size measures. It provides distribution-free inference that is exact (when all permutations
are enumerated) or approximate (when randomization sampling is used).

The test uses an unstudentized approach where the test statistic is the effect size itself.
This avoids the need to compute standard errors for each permutation and sidesteps boundary
case issues that can arise with studentized approaches.

The available effect size measures are:
\itemize{
\item \strong{Rank-biserial correlation ("rb")}: Ranges from -1 to 1. No effect corresponds to 0.
\item \strong{Concordance statistic ("cstat")}: Ranges from 0 to 1. No effect corresponds to 0.5.
\item \strong{WMW odds ("odds")}: Ranges from 0 to infinity. No effect corresponds to 1.
\item \strong{WMW log-odds ("logodds")}: Ranges from -infinity to infinity. No effect corresponds to 0.
}
\subsection{Permutation Procedure}{

For two-sample (independent groups) tests, permutation is performed by randomly reassigning
observations to groups. For paired and one-sample tests, permutation is performed by randomly
flipping the sign of differences (equivalent to randomly swapping x and y within pairs).

If the number of possible permutations is less than or equal to R (or R is NULL), all exact
permutations are computed and a message is printed.
}

\subsection{P-Value Computation}{

For different alternatives, the p-values are calculated as follows:
\itemize{
\item "two.sided": Either symmetric (proportion of |T*| >= |T - null|) or equal-tail
(2 * min of one-sided p-values) depending on the \code{symmetric} argument
\item "less": Proportion of T* <= T
\item "greater": Proportion of T* >= T
\item "equivalence": Maximum of two one-sided p-values, following the IU-NPC approach
of Arboretti et al. (2021)
\item "minimal.effect": Minimum of two one-sided p-values
}
}

\subsection{Confidence Intervals}{

Confidence intervals are computed using the percentile method on the permutation distribution.
For bounded scales, intervals are clamped to the valid range (e.g., \link{-1, 1} for rb,
\link{0, 1} for cstat).
}

\subsection{Ties}{

Ties are handled using the midrank method (average ranks), which is the standard approach
for Wilcoxon-type statistics. No special correction is applied.
}
}
\section{Purpose}{

Use this function when:
\itemize{
\item You want a distribution-free hypothesis test for rank-based effect sizes
\item Sample sizes are small where asymptotic approximations (from \code{\link[=ses_calc]{ses_calc()}}) may be unreliable
\item You want exact p-values without relying on normal approximations
\item You need equivalence or minimal effect testing with permutation methods
}
}

\examples{
# Example 1: Two-sample test with rank-biserial correlation
set.seed(123)
x <- c(1.2, 2.3, 3.1, 4.6, 5.2, 6.7)
y <- c(3.5, 4.8, 5.6, 6.9, 7.2, 8.5)
perm_ses_test(x = x, y = y, ses = "rb")

# Example 2: Concordance statistic with one-sided test
perm_ses_test(x = x, y = y, ses = "cstat", alternative = "less")

# Example 3: Paired samples
data(sleep)
with(sleep, perm_ses_test(x = extra[group == 1],
                           y = extra[group == 2],
                           paired = TRUE,
                           ses = "rb",
                           R = 999))

# Example 4: Equivalence testing
perm_ses_test(x = x, y = y, ses = "rb",
              alternative = "equivalence",
              mu = c(-0.8, 0.8), R = 999)

# Example 5: Formula interface
data(mtcars)
perm_ses_test(formula = mpg ~ am, data = mtcars,
              ses = "rb", R = 999)

}
\references{
Arboretti, R., Pesarin, F., & Salmaso, L. (2021). A unified approach to permutation testing
for equivalence. \emph{Statistical Methods & Applications}, 30, 1033-1052.

Agresti, A. (1980). Generalized odds ratios for ordinal data. \emph{Biometrics}, 36, 59-67.

Phipson, B., & Smyth, G. K. (2010). Permutation P-values should never be zero: calculating
exact P-values when permutations are randomly drawn. \emph{Statistical Applications in Genetics
and Molecular Biology}, 9(1), Article 39.
}
\seealso{
Other Robust tests: 
\code{\link{boot_log_TOST}()},
\code{\link{boot_t_TOST}()},
\code{\link{boot_t_test}()},
\code{\link{brunner_munzel}()},
\code{\link{hodges_lehmann}()},
\code{\link{log_TOST}()},
\code{\link{perm_t_test}()},
\code{\link{wilcox_TOST}()}
}
\concept{Robust tests}
