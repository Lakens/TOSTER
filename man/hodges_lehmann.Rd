% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/hodges_lehmann.R
\name{hodges_lehmann}
\alias{hodges_lehmann}
\alias{hodges_lehmann.default}
\alias{hodges_lehmann.formula}
\title{Hodges-Lehmann Test}
\usage{
hodges_lehmann(x, ...)

\method{hodges_lehmann}{default}(
  x,
  y = NULL,
  alternative = c("two.sided", "less", "greater", "equivalence", "minimal.effect"),
  mu = 0,
  paired = FALSE,
  alpha = 0.05,
  R = NULL,
  scale = c("S2", "S1"),
  p_method = NULL,
  keep_perm = TRUE,
  ...
)

\method{hodges_lehmann}{formula}(formula, data, subset, na.action, ...)
}
\arguments{
\item{x}{a (non-empty) numeric vector of data values.}

\item{...}{further arguments (currently ignored).}

\item{y}{an optional numeric vector of data values.}

\item{alternative}{the alternative hypothesis:
- "two.sided": different from mu (default)
- "less": less than mu
- "greater": greater than mu
- "equivalence": between specified bounds
- "minimal.effect": outside specified bounds}

\item{mu}{a number or vector specifying the null hypothesis value(s):
\itemize{
\item For standard alternatives (two.sided, less, greater): a single value (default: 0)
\item For equivalence/minimal.effect: either a single value (symmetric bounds will be
created) or a vector of two values representing the lower and upper bounds
}}

\item{paired}{a logical indicating whether this is a paired test. If \code{TRUE}, \code{x} and
\code{y} must have the same length, and differences (\code{x - y}) are analyzed.}

\item{alpha}{significance level (default = 0.05). For standard alternatives, the confidence
interval has level 1-alpha. For equivalence/minimal.effect, the confidence interval
has level 1-2*alpha (90\% when alpha = 0.05).}

\item{R}{the number of permutations. Default is \code{NULL}, which uses the asymptotic test.
If \code{R >= max_perms} (the maximum number of possible permutations), exact permutation
is computed. Otherwise, Monte Carlo (permutation with replacement; i.e., randomization testing) sampling is used.}

\item{scale}{the scale estimator for standardizing the test statistic in permutation
tests. Options are:
\itemize{
\item \code{"S2"} (default): Median of absolute pairwise differences from the median-corrected
combined sample. Recommended when samples come from the same distribution under H0.
\item \code{"S1"}: Pooled within-sample absolute differences. Preferred when sample sizes are
small or unequal.
}}

\item{p_method}{the method for computing permutation p-values. Options are:
\itemize{
\item \code{NULL} (default): Automatically selects "exact" for exact permutation tests and
"plusone" for randomization tests.
\item \code{"exact"}: Uses b/R where b is the count of permutation statistics at least as
extreme as observed. Appropriate when all permutations are enumerated.
\item \code{"plusone"}: Uses (b+1)/(R+1), which guarantees p > 0 and provides exact Type I
error control for randomization tests where permutations are sampled with replacement
(Phipson & Smyth, 2010).
}}

\item{keep_perm}{logical. If \code{TRUE} (default), the permutation distribution of the test
statistic and effects are stored in the output. Set to \code{FALSE} for large datasets
to save memory.}

\item{formula}{a formula of the form lhs ~ rhs where lhs is a numeric variable giving the data values and rhs either 1 for a one-sample test or a factor with two levels giving the corresponding groups. For paired tests, use the default method with x and y vectors instead of the formula method.}

\item{data}{an optional matrix or data frame (or similar: see model.frame) containing the variables in the formula formula. By default the variables are taken from environment(formula).}

\item{subset}{an optional vector specifying a subset of observations to be used.}

\item{na.action}{a function which indicates what should happen when the data contain NAs. Defaults to getOption("na.action").}
}
\value{
A list with class \code{"htest"} containing the following components:
\itemize{
\item \code{statistic}: the value of the test statistic.
\item \code{p.value}: the p-value for the test.
\item \code{conf.int}: a confidence interval for the location parameter.
\item \code{estimate}: the Hodges-Lehmann estimate(s).
\item \code{null.value}: the specified hypothesized value(s).
\item \code{alternative}: a character string describing the alternative hypothesis.
\item \code{method}: a character string indicating the test type.
\item \code{data.name}: a character string giving the name(s) of the data.
\item \code{call}: the matched call.
\item \code{R}: the requested number of permutations (NULL for asymptotic).
\item \code{R.used}: the actual number of permutations used.
\item \code{perm.stat}: (if \code{keep_perm = TRUE}) the permutation distribution of test statistics.
\item \code{perm.eff}: (if \code{keep_perm = TRUE}) the permutation distribution of effects.
}
}
\description{
\ifelse{html}{\href{https://lifecycle.r-lib.org/articles/stages.html#maturing}{\figure{lifecycle-maturing.svg}{options: alt='[Maturing]'}}}{\strong{[Maturing]}}

Performs location tests based on the Hodges-Lehmann estimator with permutation-based
or asymptotic inference. This function supports one-sample, two-sample (independent),
and paired designs, as well as equivalence and minimal effect testing.
}
\details{
\subsection{Hodges-Lehmann Estimators}{

\strong{One-sample/paired (HL1):} The median of all pairwise averages (Walsh averages):
\deqn{\hat{\theta}_{HL1} = \text{med}\left\{\frac{X_i + X_j}{2} : 1 \leq i \leq j \leq n\right\}}

This estimator is consistent with the pseudomedian returned by \code{\link[stats:wilcox.test]{stats::wilcox.test()}}
for one-sample and paired tests.

\strong{Two-sample (HL2):} The median of all pairwise differences between samples:
\deqn{\hat{\Delta}_{HL2} = \text{med}\{Y_j - X_i : i = 1, \ldots, m; j = 1, \ldots, n\}}

This estimator is consistent with the location shift estimate returned by
\code{\link[stats:wilcox.test]{stats::wilcox.test()}} for two-sample tests.
}

\subsection{Test Methods}{

\strong{Asymptotic test (R = NULL):} Uses kernel density estimation to estimate the
variance of the Hodges-Lehmann estimator (note: this generates confidence intervals that will differ from \code{\link[stats:wilcox.test]{stats::wilcox.test()}}). The test statistic follows an approximate
normal distribution. This method may have issues with very heavy-tailed distributions,
very skewed distributions, or small sample sizes (n < 30 per group). In these cases,
consider using the permutation test instead.

\strong{Exact permutation test (R >= max_perms):} Enumerates all possible permutations
and provides exact p-values. For one-sample/paired tests, there are 2^n possible
sign-flipping permutations. For two-sample tests, there are choose(m+n, m) possible
group reassignments.

\strong{Randomization test (R < max_perms):} Samples R permutations randomly
(with replacement) and computes approximate p-values. The (b+1)/(R+1) formula
guarantees exact Type I error control (Phipson & Smyth, 2010).
}

\subsection{Scale Estimators}{

For permutation tests, the test statistic is standardized using a robust scale
estimator (Fried & Dehling, 2011):

\strong{S1 (pooled within-sample):}
\deqn{S^{(1)}_{m,n} = \text{med}\{|X_i - X_j| : 1 \leq i < j \leq m, |Y_i - Y_j| : 1 \leq i < j \leq n\}}

\strong{S2 (median-corrected joint):}
\deqn{S^{(2)}_{m,n} = \text{med}\{|Z_i - Z_j| : 1 \leq i < j \leq m+n\}}

where Z is the median-corrected combined sample.
}

\subsection{Alternatives}{

The function supports five alternative hypotheses:
\itemize{
\item \code{"two.sided"}: Tests whether the location parameter differs from \code{mu}
\item \code{"less"}: Tests whether the location parameter is less than \code{mu}
\item \code{"greater"}: Tests whether the location parameter is greater than \code{mu}
\item \code{"equivalence"}: Tests whether the location parameter lies within the bounds
specified by \code{mu} (TOST procedure)
\item \code{"minimal.effect"}: Tests whether the location parameter lies outside the bounds
specified by \code{mu}
}
}
}
\section{Purpose}{

The Hodges-Lehmann estimator provides a robust alternative to the mean for testing
location differences. It has a breakdown point of approximately 29.3\%, meaning it
remains stable even when nearly 30\% of the data are outliers. This function offers:
\itemize{
\item Exact permutation tests for small samples
\item Randomization tests (permutation with replacement) for larger samples
\item Asymptotic tests using kernel density estimation
\item Support for equivalence and minimal effect testing
\item An interface that mirrors \code{wilcox.test} and \code{perm_t_test}
}
}

\examples{
# Two-sample test (asymptotic)
set.seed(123)
x <- rnorm(30, mean = 0)
y <- rnorm(30, mean = 0.5)
hodges_lehmann(x, y)

# Two-sample test with permutation
hodges_lehmann(x, y, R = 1999)

# One-sample test
x <- rnorm(20, mean = 0.5)
hodges_lehmann(x, mu = 0)

# Paired test
before <- c(5.1, 4.8, 6.2, 5.7, 6.0, 5.5, 4.9, 5.8)
after <- c(5.6, 5.2, 6.7, 6.1, 6.5, 5.8, 5.3, 6.2)
hodges_lehmann(before, after, paired = TRUE)

# Equivalence test
hodges_lehmann(x, y, alternative = "equivalence", mu = c(-1, 1), R = 999)

# Formula interface
hodges_lehmann(extra ~ group, data = sleep)

}
\references{
Hodges, J. L., & Lehmann, E. L. (1963). Estimates of location based on rank tests.
\emph{Annals of Mathematical Statistics}, 34, 598-611.

Fried, R., & Dehling, H. (2011). Robust nonparametric tests for the two-sample
location problem. \emph{Statistical Methods & Applications}, 20, 409-422.

Lehmann, E. L. (1963). Nonparametric confidence intervals for a shift parameter.
\emph{Annals of Mathematical Statistics}, 34, 1507-1512.

Phipson, B., & Smyth, G. K. (2010). Permutation P-values should never be zero:
calculating exact P-values when permutations are randomly drawn.
\emph{Statistical Applications in Genetics and Molecular Biology}, 9(1), Article 39.
}
\seealso{
Other Robust tests: 
\code{\link{boot_log_TOST}()},
\code{\link{boot_t_TOST}()},
\code{\link{boot_t_test}()},
\code{\link{brunner_munzel}()},
\code{\link{log_TOST}()},
\code{\link{perm_t_test}()},
\code{\link{wilcox_TOST}()}
}
\concept{Robust tests}
